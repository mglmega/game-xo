window.addEventListener("load",(function(){const t=document.getElementById("startBtn"),e=document.getElementById("game"),h=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const s=document.getElementById("collision"),r=s.getContext("2d");s.width=window.innerWidth,s.height=window.innerHeight,h.font="24px Arial";const a=document.getElementById("gameoverImg"),n=document.getElementById("eviljestAudio"),o=document.getElementById("welldoneAudio");let d,m,l,c,g,f,w,y,u;function p(){d=3,m=100,l=1,c=[],g=0,f=500,w=0,y=!1,u=[],h.clearRect(0,0,e.width,e.height),r.clearRect(0,0,e.width,e.height),t.style.display="block"}class I{constructor(t=!1){this.spriteWidth=220,this.spriteHeight=320,this.sizeModifier=t?.3:.6*Math.random()+.4,this.width=this.spriteWidth*this.sizeModifier,this.height=this.spriteHeight*this.sizeModifier,this.x=e.width,this.y=Math.random()*(e.height-this.height),this.directionX=5*Math.random()+3,this.directionY=5*Math.random()-2.5,this.markDeletion=!1,this.randomColor=[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],this.color=`rgb(${this.randomColor[0]},${this.randomColor[1]},${this.randomColor[2]})`,this.image=document.getElementById("mgImg"),this.frame=0,this.maxFrame=5,this.timeSinceLastFrame=0,this.frameInterval=50,this.markSenser=t}update(t){this.timeSinceLastFrame+=t,this.timeSinceLastFrame>this.frameInterval&&(this.frame>=this.maxFrame?this.frame=0:this.frame++,this.timeSinceLastFrame=0),(this.y<0||e.height<this.y+this.height)&&(this.directionY=-1*this.directionY),this.x-=this.directionX,this.y+=this.directionY,this.x+this.width<0&&(this.markDeletion=!0,d--,0===d&&(y=!0))}draw(){r.fillStyle=this.color,r.fillRect(this.x,this.y,this.width,this.height),h.drawImage(this.image,this.frame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height)}}class x{constructor(t,i,e){this.image=document.getElementById("boomImg"),this.spriteWidth=200,this.spriteHeight=179,this.size=e,this.x=t,this.y=i,this.frame=0,this.sound=document.getElementById("zombieAudio"),this.timeSinceLastFrame=0,this.frameInterval=200,this.markDeletion=!1}update(t){0===this.frame&&this.sound.play(),this.timeSinceLastFrame+=t,this.timeSinceLastFrame>this.frameInterval&&(this.frame++,this.timeSinceLastFrame=0,this.frame>5&&(this.markDeletion=!0))}draw(){h.drawImage(this.image,this.frame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.size,this.size)}}function E(t){h.clearRect(0,0,e.width,e.height),r.clearRect(0,0,e.width,e.height);let s=t-w;w=t,g+=s,l===c.length&&(f=0),g>f&&l>c.length&&m>0&&(c.push(new I(m<=d)),g=0,m--,c.sort(((t,i)=>t.width-i.width))),m%10==0&&(l+=1),h.textAlign="left",h.fillStyle="black",h.fillText(`Үлдсэн : ${m}`,50,75),h.fillStyle="white",h.fillText(`Үлдсэн : ${m}`,48,73),function(){const t=document.getElementById("heartImg"),s=106/3,r=100/3;let a=50;for(i=d;i>0;i--)h.drawImage(t,a,e.height-r-20,s,r),a+=s+3}(),[...c,...u].forEach((t=>t.update(s))),[...c,...u].forEach((t=>t.draw())),c=c.filter((t=>!t.markDeletion)),u=u.filter((t=>!t.markDeletion)),c.length||0!==m||(y=!0),y?(h.clearRect(0,0,e.width,e.height),r.clearRect(0,0,e.width,e.height),d<=0?(n.play(),h.drawImage(a,(e.width-354)/2,(e.height-500)/2,354,500)):(o.play(),h.font="48px Arial",h.textAlign="center",h.fillStyle="black",h.fillText("Сайн юмаа. Та яллаа.",e.width/2,e.height/2),h.fillStyle="white",h.fillText("Сайн юмаа. Та яллаа.",e.width/2-3,e.height/2-3)),setTimeout(p,8e3)):requestAnimationFrame(E)}window.addEventListener("click",(function(t){const i=r.getImageData(t.x,t.y,3,3).data;c.forEach((h=>{h.randomColor[0]===i[0]&&h.randomColor[1]===i[1]&&h.randomColor[2]===i[2]&&(h.markSenser?h.directionY<0?h.height+50<t.y?h.y=t.y-h.height-30:(h.y=t.y+30,h.directionY*=-1):e.height>t.y+h.height+50?h.y=t.y+30:(h.directionY*=-1,h.y=t.y-h.height-30):(h.markDeletion=!0,u.push(new x(h.x,h.y,h.width))))}))})),t.addEventListener("click",(t=>{t.target.style.display="none",E(0)})),p()}));